<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Donations – Auto Counter (BNB)</title>
  <style>
    :root { --bg:#0a0b0e; --text:#e8eef7; --muted:#9aa3b2; --accent:#f3ba2f; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;display:flex;align-items:center;justify-content:center;background:#0a0b0e;color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{width:100%;max-width:1000px;padding:24px;text-align:center}
    h1{font-size:clamp(18px,2.5vw,22px);font-weight:600;color:var(--muted);margin:0 0 16px}
    .amt{font-weight:700; font-size:clamp(42px,12vw,120px); line-height:1.05; letter-spacing:1px; color:var(--accent)}
    .sub{margin-top:8px;color:var(--muted);font-size:clamp(12px,1.6vw,14px)}
    .err{color:#ff8a8a}
    .blink{animation:blink 1s step-start 2}
    @keyframes blink{50%{opacity:.35}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>BNB Donations (Σ of all values with “BNB” ÷ 2)</h1>
    <div id="amount" class="amt">0 BNB</div>
    <div id="meta" class="sub">Waiting for data…</div>
  </div>

<script>
(function(){
  var elAmt = document.getElementById('amount');
  var elMeta = document.getElementById('meta');

  var DEFAULT_URL = 'https://bscscan.com/txsInternal?a=0xbf310C4060c5399BE02B51f07850BAFF91269179&ps=100';

  var qs = new URLSearchParams(location.search);
  var target = qs.get('url') || DEFAULT_URL;
  var divide = Number(qs.get('divide')||2);
  var refreshMs = Number(qs.get('refresh_ms')||60000);

  function extractBNBValues(text){
    var re = /([0-9]+(?:\.[0-9]+)?)\s*BNB/gi;
    var matches = [];
    var nums = [];
    var m;
    while((m = re.exec(text)) !== null){
      matches.push(m[0]);
      var val = parseFloat(m[1]);
      if(!Number.isNaN(val)) nums.push(val);
    }
    var total = nums.reduce(function(a,b){return a+b;},0);
    return { matches: matches, total: total };
  }

  function stripProtocol(u){
    if(u.indexOf('https://')===0) return u.slice(8);
    if(u.indexOf('http://')===0) return u.slice(7);
    return u;
  }

  function fetchViaProxy(url){
    return fetch('/api/proxy?url=' + encodeURIComponent(url))
      .then(function(r){ if(!r.ok) throw new Error('proxy ' + r.status); return r.text(); })
      .catch(function(){
        var noProto = stripProtocol(url);
        return fetch('https://r.jina.ai/http/' + noProto, { headers:{ 'accept':'text/plain' } })
          .then(function(r){ if(!r.ok) throw new Error('fallback ' + r.status); return r.text(); });
      });
  }

  function tick(){
    elMeta.textContent = 'Fetching…';
    var t0 = performance.now();
    fetchViaProxy(target).then(function(text){
      var out = extractBNBValues(text);
      var half = out.total / (divide || 1);
      var t1 = performance.now();
      elAmt.textContent = half.toLocaleString(undefined,{ maximumFractionDigits:8 }) + ' BNB';
      elAmt.classList.add('blink'); setTimeout(function(){ elAmt.classList.remove('blink'); }, 1100);
      elMeta.innerHTML = 'Source: <a href="' + target + '" target="_blank" rel="noreferrer">BscScan</a> · Found ' + out.matches.length + ' BNB-values · Total: ' + out.total.toLocaleString(undefined,{ maximumFractionDigits:8 }) + ' BNB · Displayed ÷ ' + divide + ' · ' + (t1 - t0 | 0) + ' ms';
    }).catch(function(err){
      console.error(err);
      elMeta.innerHTML = '<span class="err">Error:</span> ' + err.message;
    });
  }

  tick();
  if (refreshMs > 0) setInterval(tick, refreshMs);
})();
</script>
</body>
</html>
